{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport { Component } from 'react';\nimport { classNames } from \"../../lib/classNames\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from '@vkontakte/icons';\nimport { IOS, VKCOM } from \"../../lib/platform\";\nimport Touch from \"../Touch/Touch\";\nimport { setRef } from \"../../lib/utils\";\nimport Text from \"../Typography/Text/Text\";\nimport Title from \"../Typography/Title/Title\";\nimport { Separator } from \"../../index\";\nvar searchId = 0;\n\nvar Search = /*#__PURE__*/function (_Component) {\n  _inherits(Search, _Component);\n\n  var _super = _createSuper(Search);\n\n  function Search(props) {\n    var _this;\n\n    _classCallCheck(this, Search);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"isControlledOutside\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"inputEl\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"searchId\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"onFocus\", function (e) {\n      _this.setState({\n        focused: true\n      });\n\n      _this.props.onFocus && _this.props.onFocus(e);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onBlur\", function (e) {\n      _this.setState({\n        focused: false\n      });\n\n      _this.props.onBlur && _this.props.onBlur(e);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (e) {\n      var target = e.target;\n\n      if (!_this.isControlledOutside) {\n        _this.setState({\n          value: target.value\n        });\n      }\n\n      if (_this.props.onChange) {\n        _this.props.onChange(e);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCancel\", function () {\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      var nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n      nativeInputValueSetter.call(_this.inputEl, '');\n      var ev2 = new Event('input', {\n        bubbles: true\n      });\n\n      _this.inputEl.dispatchEvent(ev2);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onIconClickStart\", function (e) {\n      _this.props.onIconClick && _this.props.onIconClick(e.originalEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onIconCancelClickStart\", function (e) {\n      e.originalEvent.preventDefault();\n\n      _this.inputEl.focus();\n\n      _this.onCancel();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"inputRef\", function (element) {\n      _this.inputEl = element;\n      setRef(element, _this.props.getRef);\n    });\n\n    var state = {\n      focused: false\n    };\n\n    if (props.hasOwnProperty('value')) {\n      _this.isControlledOutside = true;\n    } else {\n      state.value = props.defaultValue || '';\n    }\n\n    _this.searchId = \"search-\".concat(searchId++);\n    _this.state = state;\n    return _this;\n  }\n\n  _createClass(Search, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          before = _this$props.before,\n          className = _this$props.className,\n          onFocus = _this$props.onFocus,\n          onBlur = _this$props.onBlur,\n          onChange = _this$props.onChange,\n          defaultValue = _this$props.defaultValue,\n          value = _this$props.value,\n          placeholder = _this$props.placeholder,\n          after = _this$props.after,\n          getRef = _this$props.getRef,\n          platform = _this$props.platform,\n          icon = _this$props.icon,\n          onIconClick = _this$props.onIconClick,\n          style = _this$props.style,\n          inputProps = _objectWithoutProperties(_this$props, [\"before\", \"className\", \"onFocus\", \"onBlur\", \"onChange\", \"defaultValue\", \"value\", \"placeholder\", \"after\", \"getRef\", \"platform\", \"icon\", \"onIconClick\", \"style\"]);\n\n      return createScopedElement(\"div\", {\n        vkuiClass: classNames(getClassName('Search', platform), {\n          'Search--focused': this.state.focused,\n          'Search--has-value': !!this.value,\n          'Search--has-after': !!after,\n          'Search--has-icon': !!icon\n        }),\n        className: className,\n        style: style\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"Search__in\"\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"Search__width\"\n      }), createScopedElement(\"label\", {\n        vkuiClass: \"Search__control\"\n      }, createScopedElement(\"input\", _extends({}, inputProps, {\n        ref: this.inputRef,\n        type: \"text\",\n        vkuiClass: \"Search__input\",\n        onFocus: this.onFocus,\n        onBlur: this.onBlur,\n        onChange: this.onChange,\n        value: this.value\n      })), platform === IOS && after && createScopedElement(\"div\", {\n        vkuiClass: \"Search__after-width\"\n      }, after), createScopedElement(\"div\", {\n        vkuiClass: \"Search__placeholder\"\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"Search__placeholder-in\"\n      }, before, platform === VKCOM ? createScopedElement(Text, {\n        vkuiClass: \"Search__placeholder-text\",\n        weight: \"regular\"\n      }, placeholder) : createScopedElement(Title, {\n        vkuiClass: \"Search__placeholder-text\",\n        level: \"3\",\n        weight: \"regular\"\n      }, placeholder)), this.state.focused && platform === IOS && after && createScopedElement(\"div\", {\n        vkuiClass: \"Search__after-width\"\n      }, after))), createScopedElement(\"div\", {\n        vkuiClass: \"Search__after\",\n        onClick: this.onCancel\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"Search__icons\"\n      }, icon && createScopedElement(Touch, {\n        onStart: this.onIconClickStart,\n        vkuiClass: \"Search__icon\"\n      }, icon), !!this.value && createScopedElement(Touch, {\n        onStart: this.onIconCancelClickStart,\n        vkuiClass: \"Search__icon\"\n      }, platform === VKCOM ? createScopedElement(Icon24Cancel, null) : createScopedElement(Icon16Clear, null))), platform === IOS && after && createScopedElement(\"div\", {\n        vkuiClass: \"Search__after-in\"\n      }, after))), platform === VKCOM && createScopedElement(Separator, {\n        vkuiClass: \"Search__separator\",\n        wide: true\n      }));\n    }\n  }, {\n    key: \"value\",\n    get: function get() {\n      return this.isControlledOutside ? this.props.value : this.state.value;\n    }\n  }]);\n\n  return Search;\n}(Component);\n\n_defineProperty(Search, \"defaultProps\", {\n  autoComplete: 'off',\n  placeholder: 'Поиск',\n  after: 'Отмена',\n  before: createScopedElement(Icon16SearchOutline, null)\n});\n\nexport default withPlatform(Search);","map":{"version":3,"sources":["../../../src/components/Search/Search.tsx"],"names":["searchId","Search","Component","autoComplete","placeholder","after","before","state","focused","props","target","e","value","nativeInputValueSetter","Object","window","ev2","bubbles","setRef","className","onFocus","onBlur","onChange","defaultValue","getRef","platform","icon","onIconClick","style","inputProps","classNames","getClassName","onCancel","withPlatform"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAA,SAAA,QAAA,OAAA;AASA,SAAA,UAAA,QAAA,sBAAA;AACA,SAAA,YAAA,QAAA,wBAAA;AACA,SAAA,YAAA,QAAA,4BAAA;AACA,SAAA,mBAAA,EAAA,WAAA,EAAA,YAAA,QAAA,kBAAA;AACA,SAAA,GAAA,EAAA,KAAA,QAAA,oBAAA;AAEA,OAAA,KAAA,MAAA,gBAAA;AAEA,SAAA,MAAA,QAAA,iBAAA;AACA,OAAA,IAAA,MAAA,yBAAA;AACA,OAAA,KAAA,MAAA,2BAAA;AACA,SAAA,SAAA,QAAA,aAAA;AAEA,IAAIA,QAAQ,GAAZ,CAAA;;IAoBMC,M;;;;;AAcJ,WAAA,MAAA,CAAA,KAAA,EAAgC;AAAA,QAAA,KAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,MAAA,CAAA;;AAC9B,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAA,KAAA,CAAA;;AAD8B,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,qBAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,SAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,UAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,SAAA,EAoBH,UAAA,CAAA,EAAqC;AAChE,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEO,QAAAA,OAAO,EAAE;AAAX,OAAd;;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,OAAA,IAAsB,KAAA,CAAA,KAAA,CAAA,OAAA,CAAtB,CAAsB,CAAtB;AAtB8B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,QAAA,EAyBJ,UAAA,CAAA,EAAqC;AAC/D,MAAA,KAAA,CAAA,QAAA,CAAc;AAAEA,QAAAA,OAAO,EAAE;AAAX,OAAd;;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,MAAA,IAAqB,KAAA,CAAA,KAAA,CAAA,MAAA,CAArB,CAAqB,CAArB;AA3B8B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,UAAA,EA8BD,UAAA,CAAA,EAAuC;AACpE,UAAME,MAAM,GAAGC,CAAC,CAAhB,MAAA;;AACA,UAAI,CAAC,KAAA,CAAL,mBAAA,EAA+B;AAC7B,QAAA,KAAA,CAAA,QAAA,CAAc;AAAEC,UAAAA,KAAK,EAAEF,MAAM,CAACE;AAAhB,SAAd;AACD;;AACD,UAAI,KAAA,CAAA,KAAA,CAAJ,QAAA,EAAyB;AACvB,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,CAAA;AACD;AArC6B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,UAAA,EAwCP,YAAM;AAC7B;AACA,UAAMC,sBAAsB,GAAGC,MAAM,CAANA,wBAAAA,CAAgCC,MAAM,CAANA,gBAAAA,CAAhCD,SAAAA,EAAAA,OAAAA,EAA/B,GAAA;AACAD,MAAAA,sBAAsB,CAAtBA,IAAAA,CAA4B,KAAA,CAA5BA,OAAAA,EAAAA,EAAAA;AAEA,UAAMG,GAAG,GAAG,IAAA,KAAA,CAAA,OAAA,EAAmB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAAnB,CAAZ;;AACA,MAAA,KAAA,CAAA,OAAA,CAAA,aAAA,CAAA,GAAA;AA9C8B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,kBAAA,EAiDM,UAAA,CAAA,EAAmB;AACvD,MAAA,KAAA,CAAA,KAAA,CAAA,WAAA,IAA0B,KAAA,CAAA,KAAA,CAAA,WAAA,CAAuBN,CAAC,CAAlD,aAA0B,CAA1B;AAlD8B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,wBAAA,EAqDY,UAAA,CAAA,EAAmB;AAC7DA,MAAAA,CAAC,CAADA,aAAAA,CAAAA,cAAAA;;AACA,MAAA,KAAA,CAAA,OAAA,CAAA,KAAA;;AACA,MAAA,KAAA,CAAA,QAAA;AAxD8B,KAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,UAAA,EA2DX,UAAA,OAAA,EAA+B;AAClD,MAAA,KAAA,CAAA,OAAA,GAAA,OAAA;AACAO,MAAAA,MAAM,CAAA,OAAA,EAAU,KAAA,CAAA,KAAA,CAAhBA,MAAM,CAANA;AA7D8B,KAAA,CAAA;;AAG9B,QAAMX,KAAkB,GAAG;AACzBC,MAAAA,OAAO,EAAE;AADgB,KAA3B;;AAIA,QAAIC,KAAK,CAALA,cAAAA,CAAJ,OAAIA,CAAJ,EAAmC;AACjC,MAAA,KAAA,CAAA,mBAAA,GAAA,IAAA;AADF,KAAA,MAEO;AACLF,MAAAA,KAAK,CAALA,KAAAA,GAAcE,KAAK,CAALA,YAAAA,IAAdF,EAAAA;AACD;;AACD,IAAA,KAAA,CAAA,QAAA,GAAA,UAAA,MAAA,CAA0BP,QAA1B,EAAA,CAAA;AACA,IAAA,KAAA,CAAA,KAAA,GAAA,KAAA;AAb8B,WAAA,KAAA;AAc/B;;;;6BAkDQ;AAAA,UAAA,WAAA,GAiBH,KAjBG,KAAA;AAAA,UAELM,MAFK,GAAA,WAAA,CAAA,MAAA;AAAA,UAGLa,SAHK,GAAA,WAAA,CAAA,SAAA;AAAA,UAILC,OAJK,GAAA,WAAA,CAAA,OAAA;AAAA,UAKLC,MALK,GAAA,WAAA,CAAA,MAAA;AAAA,UAMLC,QANK,GAAA,WAAA,CAAA,QAAA;AAAA,UAOLC,YAPK,GAAA,WAAA,CAAA,YAAA;AAAA,UAQLX,KARK,GAAA,WAAA,CAAA,KAAA;AAAA,UASLR,WATK,GAAA,WAAA,CAAA,WAAA;AAAA,UAULC,KAVK,GAAA,WAAA,CAAA,KAAA;AAAA,UAWLmB,MAXK,GAAA,WAAA,CAAA,MAAA;AAAA,UAYLC,QAZK,GAAA,WAAA,CAAA,QAAA;AAAA,UAaLC,IAbK,GAAA,WAAA,CAAA,IAAA;AAAA,UAcLC,WAdK,GAAA,WAAA,CAAA,WAAA;AAAA,UAeLC,KAfK,GAAA,WAAA,CAAA,KAAA;AAAA,UAgBFC,UAhBE,GAAA,wBAAA,CAAA,WAAA,EAAA,CAAA,QAAA,EAAA,WAAA,EAAA,SAAA,EAAA,QAAA,EAAA,UAAA,EAAA,cAAA,EAAA,OAAA,EAAA,aAAA,EAAA,OAAA,EAAA,QAAA,EAAA,UAAA,EAAA,MAAA,EAAA,aAAA,EAAA,OAAA,CAAA,CAAA;;AAmBP,aACE,mBAAA,CAAA,KAAA,EAAA;AACE,QAAA,SAAS,EAAEC,UAAU,CAACC,YAAY,CAAA,QAAA,EAAb,QAAa,CAAb,EAAmC;AACtD,6BAAmB,KAAA,KAAA,CADmC,OAAA;AAEtD,+BAAqB,CAAC,CAAC,KAF+B,KAAA;AAGtD,+BAAqB,CAAC,CAHgC,KAAA;AAItD,8BAAoB,CAAC,CAACL;AAJgC,SAAnC,CADvB;AAOE,QAAA,SAAS,EAPX,SAAA;AAQE,QAAA,KAAK,EAAEE;AART,OAAA,EAUE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EACE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,CADF,EAEE,mBAAA,CAAA,OAAA,EAAA;AAAO,QAAA,SAAS,EAAC;AAAjB,OAAA,EACE,mBAAA,CAAA,OAAA,EAAA,QAAA,CAAA,EAAA,EAAA,UAAA,EAAA;AAEE,QAAA,GAAG,EAAE,KAFP,QAAA;AAGE,QAAA,IAAI,EAHN,MAAA;AAIE,QAAA,SAAS,EAJX,eAAA;AAKE,QAAA,OAAO,EAAE,KALX,OAAA;AAME,QAAA,MAAM,EAAE,KANV,MAAA;AAOE,QAAA,QAAQ,EAAE,KAPZ,QAAA;AAQE,QAAA,KAAK,EAAE,KAAKhB;AARd,OAAA,CAAA,CADF,EAWGa,QAAQ,KAARA,GAAAA,IAAAA,KAAAA,IAA6B,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAXhC,KAWgC,CAXhC,EAYE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EACE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAAA,MAAA,EAEGA,QAAQ,KAARA,KAAAA,GACG,mBAAA,CAAA,IAAA,EAAA;AAAM,QAAA,SAAS,EAAf,0BAAA;AAA2C,QAAA,MAAM,EAAC;AAAlD,OAAA,EADHA,WACG,CADHA,GAEG,mBAAA,CAAA,KAAA,EAAA;AAAO,QAAA,SAAS,EAAhB,0BAAA;AAA4C,QAAA,KAAK,EAAjD,GAAA;AAAsD,QAAA,MAAM,EAAC;AAA7D,OAAA,EALR,WAKQ,CAJN,CADF,EAQG,KAAA,KAAA,CAAA,OAAA,IAAsBA,QAAQ,KAA9B,GAAA,IAAA,KAAA,IAAmD,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EAtB1D,KAsB0D,CARtD,CAZF,CAFF,EAyBE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,eAAA;AAA+B,QAAA,OAAO,EAAE,KAAKO;AAA7C,OAAA,EACE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EACGN,IAAI,IACH,mBAAA,CAAA,KAAA,EAAA;AAAO,QAAA,OAAO,EAAE,KAAhB,gBAAA;AAAuC,QAAA,SAAS,EAAC;AAAjD,OAAA,EAFJ,IAEI,CAFJ,EAMG,CAAC,CAAC,KAAF,KAAA,IACC,mBAAA,CAAA,KAAA,EAAA;AAAO,QAAA,OAAO,EAAE,KAAhB,sBAAA;AAA6C,QAAA,SAAS,EAAC;AAAvD,OAAA,EACGD,QAAQ,KAARA,KAAAA,GACG,mBAAA,CAAA,YAAA,EADHA,IACG,CADHA,GAEG,mBAAA,CAAA,WAAA,EAXZ,IAWY,CAHN,CAPJ,CADF,EAgBGA,QAAQ,KAARA,GAAAA,IAAAA,KAAAA,IACC,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EApDR,KAoDQ,CAjBJ,CAzBF,CAVF,EAwDGA,QAAQ,KAARA,KAAAA,IAAsB,mBAAA,CAAA,SAAA,EAAA;AAAW,QAAA,SAAS,EAApB,mBAAA;AAAyC,QAAA,IAAI,EAAA;AAA7C,OAAA,CAxDzB,CADF;AA4DD;;;wBA/HW;AACV,aAAO,KAAA,mBAAA,GAA2B,KAAA,KAAA,CAA3B,KAAA,GAA8C,KAAA,KAAA,CAArD,KAAA;AACD;;;;EAhCkBvB,S;;gBAAfD,M,kBAC+B;AACjCE,EAAAA,YAAY,EADqB,KAAA;AAEjCC,EAAAA,WAAW,EAFsB,OAAA;AAGjCC,EAAAA,KAAK,EAH4B,QAAA;AAIjCC,EAAAA,MAAM,EAAE,mBAAA,CAAA,mBAAA,EAAA,IAAA;AAJyB,C;;AA+JrC,eAAe2B,YAAY,CAA3B,MAA2B,CAA3B","sourcesContent":["import {\n  Component,\n  ReactNode,\n  FocusEvent,\n  FocusEventHandler,\n  InputHTMLAttributes,\n  ChangeEvent,\n  ChangeEventHandler,\n} from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { getClassName } from '../../helpers/getClassName';\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from '@vkontakte/icons';\nimport { IOS, VKCOM } from '../../lib/platform';\nimport { HasPlatform, HasRef } from '../../types';\nimport Touch, { TouchEventHandler, TouchEvent } from '../Touch/Touch';\nimport { VKUITouchEvent } from '../../lib/touch';\nimport { setRef } from '../../lib/utils';\nimport Text from '../Typography/Text/Text';\nimport Title from '../Typography/Title/Title';\nimport { Separator } from '../../index';\n\nlet searchId = 0;\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\nexport interface SearchProps extends InputHTMLAttributes<HTMLInputElement>, HasRef<HTMLInputElement>, HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: ReactNode;\n  before?: ReactNode;\n  icon?: ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\nexport interface SearchState {\n  value?: string;\n  focused?: boolean;\n}\n\nclass Search extends Component<SearchProps, SearchState> {\n  static defaultProps: SearchProps = {\n    autoComplete: 'off',\n    placeholder: 'Поиск',\n    after: 'Отмена',\n    before: <Icon16SearchOutline />,\n  };\n\n  isControlledOutside: boolean;\n\n  inputEl: HTMLInputElement;\n\n  searchId: string;\n\n  constructor(props: SearchProps) {\n    super(props);\n\n    const state: SearchState = {\n      focused: false,\n    };\n\n    if (props.hasOwnProperty('value')) {\n      this.isControlledOutside = true;\n    } else {\n      state.value = props.defaultValue || '';\n    }\n    this.searchId = `search-${searchId++}`;\n    this.state = state;\n  }\n\n  get value() {\n    return this.isControlledOutside ? this.props.value : this.state.value;\n  }\n\n  onFocus: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: true });\n    this.props.onFocus && this.props.onFocus(e);\n  };\n\n  onBlur: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: false });\n    this.props.onBlur && this.props.onBlur(e);\n  };\n\n  onChange: ChangeEventHandler = (e?: ChangeEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    if (!this.isControlledOutside) {\n      this.setState({ value: target.value });\n    }\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  onCancel: VoidFunction = () => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(this.inputEl, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    this.inputEl.dispatchEvent(ev2);\n  };\n\n  onIconClickStart: TouchEventHandler = (e: TouchEvent) => {\n    this.props.onIconClick && this.props.onIconClick(e.originalEvent);\n  };\n\n  onIconCancelClickStart: TouchEventHandler = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n    this.inputEl.focus();\n    this.onCancel();\n  };\n\n  inputRef: InputRef = (element: HTMLInputElement) => {\n    this.inputEl = element;\n    setRef(element, this.props.getRef);\n  };\n\n  render() {\n    const {\n      before,\n      className,\n      onFocus,\n      onBlur,\n      onChange,\n      defaultValue,\n      value,\n      placeholder,\n      after,\n      getRef,\n      platform,\n      icon,\n      onIconClick,\n      style,\n      ...inputProps\n    } = this.props;\n\n    return (\n      <div\n        vkuiClass={classNames(getClassName('Search', platform), {\n          'Search--focused': this.state.focused,\n          'Search--has-value': !!this.value,\n          'Search--has-after': !!after,\n          'Search--has-icon': !!icon,\n        })}\n        className={className}\n        style={style}\n      >\n        <div vkuiClass=\"Search__in\">\n          <div vkuiClass=\"Search__width\" />\n          <label vkuiClass=\"Search__control\">\n            <input\n              {...inputProps}\n              ref={this.inputRef}\n              type=\"text\"\n              vkuiClass=\"Search__input\"\n              onFocus={this.onFocus}\n              onBlur={this.onBlur}\n              onChange={this.onChange}\n              value={this.value}\n            />\n            {platform === IOS && after && <div vkuiClass=\"Search__after-width\">{after}</div>}\n            <div vkuiClass=\"Search__placeholder\">\n              <div vkuiClass=\"Search__placeholder-in\">\n                {before}\n                {platform === VKCOM\n                  ? <Text vkuiClass=\"Search__placeholder-text\" weight=\"regular\">{placeholder}</Text>\n                  : <Title vkuiClass=\"Search__placeholder-text\" level=\"3\" weight=\"regular\">{placeholder}</Title>\n                }\n              </div>\n              {this.state.focused && platform === IOS && after && <div vkuiClass=\"Search__after-width\">{after}</div>}\n            </div>\n          </label>\n          <div vkuiClass=\"Search__after\" onClick={this.onCancel}>\n            <div vkuiClass=\"Search__icons\">\n              {icon &&\n                <Touch onStart={this.onIconClickStart} vkuiClass=\"Search__icon\">\n                  {icon}\n                </Touch>\n              }\n              {!!this.value &&\n                <Touch onStart={this.onIconCancelClickStart} vkuiClass=\"Search__icon\">\n                  {platform === VKCOM\n                    ? <Icon24Cancel />\n                    : <Icon16Clear />\n                  }\n                </Touch>\n              }\n            </div>\n            {platform === IOS && after &&\n              <div vkuiClass=\"Search__after-in\">{after}</div>\n            }\n          </div>\n        </div>\n        {platform === VKCOM && <Separator vkuiClass=\"Search__separator\" wide />}\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Search);\n"]},"metadata":{},"sourceType":"module"}